<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel='stylesheet' href='/stylesheets/main.css'/>
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <link rel="import" href="/dgm-navbar/dgm-navbar.html">
    <link rel="import" href="/dgm-footer/dgm-footer.html">

    <title><%= title %></title>

    <style>
        div.google-visualization-tooltip > ul > li > span {
            /*color: #f6f6f6 !important;*/
            font-size: 8pt !important;
            font-family: "Open Sans" !important;
        }
        div.google-visualization-tooltip {
            background: #f6f6f6;
            border: white !important;
        }

        .jqplot-highlighter-tooltip, .jqplot-canvasOverlay-tooltip {
            z-index: 2;
            background: #f6f6f6 !IMPORTANT;
            font-color: black !IMPORTANT;
            font-family: "Open Sans" !important;
            border: white !IMPORTANT;
        }

        .jqplot-table-legend {
            width: auto;
            border-color: transparent !important;
            background: transparent !important;
            padding: 5px;
        }

    </style>
</head>
<body style="background: #eee">

<dgm-navbar></dgm-navbar>
<section id="banner">
    <div class="container-fluid fixed">
        <p class="text-left"><b>Nuevo Aeropuerto Intenacional de la Ciudad de México</b></p>

    </div>
</section>

<section id="highlights">
    <div class="content">
        <div class="overlay"></div>
        <div class="container-fluid">
            <div class="row">
                <div class='col-xs-12'><h3 class="jumbo-title">Estándar de Contrataciones Abiertas</h3></div>
            </div>
            <div class="row">
                <div class='col-xs-8'>
                    <p>Visualiza y descarga los Datos Abiertos de las etapas de planeación y concurso de la Red Compartida.
                        Durante el desarrollo del proyecto, trabajaremos junto con la Alianza para las Contrataciones Abiertas para continuar publicando datos accesibles,
                        comparables y oportunos sobre las siguientes etapas de adjudicación, contratación e implementación, conforme estos se generen.
                        Este proyecto es parte de un piloto para adaptar el Estándar de Datos para Contrataciones Abiertas a un modelo de alianza público privado.</p>
                </div>
                <div class='col-xs-1'></div>
                <div class='col-xs-3'><img src='/images/Logo-GACM.png'/></div>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <!--<div class="panel panel-default" style="background: #eee;">
        <div class="panel-body">-->
    <div class="row">
        <div class="col-sm-12" style=" background: white;">
            <div class="col-sm-4">
                <h3 style="color: #00cc99"><b>NAICM</b></h3>
                <h2 style="color: #673AB7"><b>25</b> <small>contratos</small></h2>
                <h2 style="color: #673AB7"><b>28</b> <small>contratistas</small></h2>
                <h2 style="color: #673AB7"><b>4,146</b> <small>millones de pesos</small></h2>

            </div>
            <div class="col-sm-8" style="overflow: auto;">
                <h3 style="text-align: left; color: #00cc99"><b>Avance físico y financiero por contrato</b></h3>
                <!--
                <div id="chart2" style="max-width:700px; height: 350px;"></div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Ordenar por <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#" data-serie = 's1' id="sort1">Avance físico</a></li>
                        <li><a href="#" data-serie = 's2' id="sort2">Avance financiero</a></li>
                    </ul>
                </div>
                <br>
                <br> -->
                <div id="d3bar"></div>
            </div>
        </div>
    </div>
    <!--
        </div>
    </div>-->

    <br>


    <!--<div class="panel panel-default" style="background: #eee">
        <div class="panel-body">-->

    <div class="row">
        <div class="col-sm-12" style="background: white">
            <div class="col-sm-4" style="background: white;">
                <h3 style="text-align: left; color: #00cc99"><b>Tipos de contratación</b></h3>
                <div  style="color: white; height: 270px; width: 260px;" id="chart4"></div>
            </div>
            <div class="col-sm-8" style="background: white; overflow: auto">
                <h3 style="text-align: left; color: #00cc99"><b>Contrataciones en el tiempo</b></h3>

                <div  style="height: 400px; width: 700px; align-content: left;" id="series_chart_div" ></div>

                <br>
            </div>
        </div>
    </div>

    <!--
        </div>
    </div>-->
    <br>
    <div class="row">
        <div class="col-sm-4">
            <div class="input-group">
                <input id="buscar" type="text" class="form-control" placeholder="Buscar..." aria-describedby="basic-addon1">
                <span class="input-group-addon" id="basic-addon1"><i class="fa fa-search"></i></span>
            </div>
        </div>
    </div>
    <br>

    <div style="font-size: small">
        <div id="ctable">
            <% include contracts %>
        </div>
    </div>
</div>

<dgm-footer></dgm-footer>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/bower_components/jqplot/jquery.jqplot.js"></script>
<script src="/bower_components/jqplot/plugins/jqplot.donutRenderer.js"></script>
<script src="/bower_components/jqplot/plugins/jqplot.barRenderer.js"></script>
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.categoryAxisRenderer.js"></script>
<!--<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>-->
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.pointLabels.js"></script>
<script type="text/javascript" src="/bower_components/jqplot/plugins/jqplot.highlighter.js"></script>
<link rel="stylesheet" type="text/css" href="/bower_components/jqplot/jquery.jqplot.css" />

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<script src="/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="/javascripts/dashboard.js"></script>
<!--
<style>

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .bar {
        fill: orange;
    }

    .bar:hover {
        fill: orangered ;
    }

    .x.axis path {
        /*display: none;*/
    }

    .d3-tip {
        line-height: 1;
        /*font-weight: bold;*/
        font-family: "Open Sans";
        padding: 12px;
        background: #f6f6f6;
        color: black;
        border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 9px;
        width: 100%;
        line-height: 1;
        color: #f6f6f6;
        /*color: rgba(0, 0, 0, 0.8);*/
        content: "\25BC";
        position: absolute;
        text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
        margin: -1px 0 0 0;
        top: 100%;
        left: 0;
    }

</style>

<script>
    var margin = {top: 40, right: 20, bottom: 40, left: 70},
            width = 750 - margin.left - margin.right,
            height = 350 - margin.top - margin.bottom;

    var formatPercent = d3.format(".0%");

    var x = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
            .range([height, 0]);

    var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickValues({})
            .tickSize(0);

    var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(formatPercent);

    var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<p>contrato</p>"+d.product+"<p>Avance físico:</p> <strong>" + (d.s1 * 100) + "%</strong>";
            })

    var svg = d3.select("#d3bar").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg.call(tip);

    d3.csv("/data.tsv", type, function(error, data) {
        x.domain(data.map(function(d) { return d.product; } ));

        y.domain([0, 1]);//d3.max(data, function(d) { return d.s1; })]);


        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .style("text-anchor", "middle")
                //.attr("y", 0 - margin.left)
                .attr("y", 40 )
                .attr("x", width/2 )
                //.attr("x", 0 - (height / 2))
                //.attr("dy", "7em")
                .text("Contratos");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                /*.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("dy", ".71em")
                .style("text-anchor", "end")*/
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Avance");

        svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function(d) { return x(d.product); })
                .attr("width", x.rangeBand())
                .attr("y", function(d) { return y(d.s1); })
                .attr("height", function(d) { return height - y(d.s1); })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide)

        svg.append("text")
                .attr("x", (width / 2))
                .attr("y", 0 - (margin.top / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                //.style("text-decoration", "underline")
                .text("Avances");
    });

    function type(d) {
        d.s1 = +d.s1;
        return d;
    }

</script>
-->


<style>
    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .bar {
        fill: steelblue;
    }

    .x.axis path {
        /*display: none;*/
    }

    .d3-tip {
        width: 250px;
        line-height: 1;
        /*font-weight: bold;*/
        font-family: "Open Sans";
        font-size: 11px;
        padding: 12px;
        background: #f6f6f6;
        color: black;
        border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 9px;
        width: 100%;
        line-height: 1;
        color: #f6f6f6;
        /*color: rgba(0, 0, 0, 0.8);*/
        content: "\25BC";
        position: absolute;
        text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
        margin: -1px 0 0 0;
        top: 100%;
        left: 0;
    }
</style>

<script>
    var margin = {top: 40, right: 20, bottom: 40, left: 70},
            width = 730 - margin.left - margin.right,
            height = 350 - margin.top - margin.bottom;

    var x0 = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);

    var x1 = d3.scale.ordinal();

    var y = d3.scale.linear()
            .range([height, 0]);

    var color = d3.scale.ordinal()
            .range([ '#00cc99', '#673AB7' ]);//, "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

    var xAxis = d3.svg.axis()
            .scale(x0)
            .orient("bottom")
            .tickValues({})
            .tickSize(0);


    var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".0%"));
            //.tickFormat(d3.format(".2s"));

    var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<p>Contrato</p><p><b>"+ d.product+"</b></p><p>"+d.name+"</p> <strong>"+ d3.format(".0%")(d.value) +"</strong>";
            })

    var svg = d3.select("#d3bar").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg.call(tip);

    d3.csv("/data.csv", function(error, data) {
        if (error) throw error;

        var ageNames = d3.keys(data[0]).filter(function(key) { return key !== "Producto"; });
        //console.log(ageNames);

        data.sort();
        data.forEach(function(d) {
            d.ages = ageNames.map(function(name) { return {name: name, value: +d[name], product : d['Producto']}; });
        });

        x0.domain(data.map(function(d) { return d.Producto; }));
        x1.domain(ageNames).rangeRoundBands([0, x0.rangeBand()]);
        y.domain([0, 1]);//d3.max(data, function(d) { return d3.max(d.ages, function(d) { return d.value; }); })]);

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .style("text-anchor", "middle")
                .attr("y", 30 )
                .attr("x", width/2 )
                .text("Contratos");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Avance");

        var producto = svg.selectAll(".producto")
                .data(data)
                .enter().append("g")
                .attr("class", "producto")
                .attr("transform", function(d) { return "translate(" + x0(d.Producto) + ",0)"; });

        producto.selectAll("rect")
                .data(function(d) { return d.ages; })
                .enter().append("rect")
                .attr("width", x1.rangeBand())
                .attr("x", function(d) {return x1(d.name);})
                .attr("y", function(d) { return y(d.value); })
                .attr("height", function(d) { return height - y(d.value); })
                .style("fill", function(d) { return color(d.name); })
                .text( function (d) {
                    return d.Producto;
                })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide);


        svg.append("text")
                .attr("x", (width / 2))
                .attr("y", 0 - (margin.top / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                //.style("text-decoration", "underline")
                .text("Avances al 10 de julio de 2016");

        var legend = svg.selectAll(".legend")
                .data(ageNames.slice().reverse())
                .enter().append("g")
                .attr("class", "legend")
                //.attr("transform","translate(50,30)")
                 .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });





        legend.append("rect")
                .attr("x", width - 18)
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", color);

        legend.append("text")
                .attr("x", width - 24)
                .attr("y", 9)
                .attr("dy", ".35em")
                .style("text-anchor", "end")
                .text(function(d) { return d; });

    });
</script>

</body>
</html>
